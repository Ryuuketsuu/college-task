<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Найди клад! </title>
  </head>
    
  <body>
    <h1 id="heading">Найди клад</h1>
    <img id="map" width=400 height=400 src="treasuremap.webp">
    <p id="clicks"></p>
    <p id="distance"></p>
    <p id="direction"></p>
    <!--добавить ловушки-->

    <script src="https://code.jquery.com/jquery-2.1.0.js"></script>
    <script>
      let getRandomNumber = function(size){
        return Math.floor(Math.random() * size);
      };

      let getDistance = function(event, target){
        const diffX = event.offsetX - target.x, 
              diffY = event.offsetY - target.y;
        return Math.sqrt((diffX * diffX) + (diffY * diffY));
      };

      let getDistanceHint = function(distance){
        if(distance < 10) {
          return `"Обожжешься!" Позиция: ${distance.toFixed(0)}`;
        } else if(distance < 20){
          return `"Очень горячо" Позиция: ${distance.toFixed(0)}`;
        } else if(distance < 40){
          return `"Горячо" Позиция: ${distance.toFixed(0)}`;
        } else if(distance < 80){
          return `"Тепло" Позиция: ${distance.toFixed(0)}`;
        } else if(distance < 160){
          return `"Холодно" Позиция: ${distance.toFixed(0)}`;
        } else if(distance < 320){
          return `"Очень холодно" Позиция: ${distance.toFixed(0)}`;
        } else{
          return `"Замерзнешь!" Позиция: ${distance.toFixed(0)}`;
        }
      };

      const width = 400, height = 400, currentClicks = 30, 
      clickElement = document.getElementById('clicks'),
      target = {
        x: getRandomNumber(width),
        y: getRandomNumber (height)
      };

      let clicks = currentClicks;
      clickElement.textContent = `У вас ${clicks} ходов`;

      $("#map").click(function (event){
        const clickElement = document.getElementById('clicks'),
              distanceElement = document.getElementById('distance'),
              directionElement = document.getElementById('direction');
        
        const distance = getDistance(event, target),
              distanceHint = getDistanceHint(distance);
        distanceElement.textContent = distanceHint;

        let direction = '';
        const diffX = target.x - event.offsetX;
        const diffY = target.y - event.offsetY;

        if(Math.abs(diffX) > Math.abs(diffY)) {
          direction = diffX > 0 ? 'Вправо' : 'Влево';
        } else {
          direction = diffY > 0 ? 'Вниз' : 'Вверх';
        }
    
        directionElement.textContent = `Иди ${direction}`;

        if(distance < 8){
          alert(`Клад найден! Сделано кликов: ${currentClicks - clicks}`);
          clicks = currentClicks;
          clickElement.textContent = `Осталось ${clicks} ходов`;
          return;
        } else if(clicks > 0){
          clicks -= 1;
          clickElement.textContent = `Осталось ${clicks} ходов`;
        } else{
          alert(`У вас не осталось ходов, игра закончилась`);
          clicks = currentClicks;
          clickElement.textContent = `Осталось ${clicks} ходов`;
          return;
        }
      });
    </script>
  </body>
</html>